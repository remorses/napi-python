# napi-python

WARNING! experimental, still does not implement all of NAPI!

Load Node-API (.node) native addons in Python.

## Usage

```python
from napi_python import load_addon

addon = load_addon("path/to/addon.node")

result = addon.add(1, 2)           # Call functions
counter = addon.Counter(10)         # Use classes
counter.increment()

result = await addon.asyncAdd(1, 2) # Async with asyncio
```

## How it works

```
Native Addon (.node)
        │
        ▼
┌───────────────────┐
│   C Shim          │  ← Exports NAPI symbols
│   libnapi_shim    │
└───────────────────┘
        │
        ▼ (function pointers)
┌───────────────────┐
│  Python Runtime   │  ← Implements NAPI via ctypes
│  _loader.py       │
└───────────────────┘
        │
        ▼
┌───────────────────┐
│  Handle Store     │  ← Maps int handles → Python objects
│  Context/Env      │
└───────────────────┘
```

## Status

**Working:**
- Functions (numbers, strings, arrays)
- Callbacks (Python lambdas as native callbacks)
- Classes (constructor, methods, getters/setters)
- Promises/async (asyncio.Future integration)
- Threadsafe functions

## TODO

### Priority 1 - Performance
- [ ] Implement hot path NAPI functions in C (eliminate ctypes overhead)

### Priority 2 - Error Handling
- [ ] napi_throw, napi_throw_error, napi_throw_type_error
- [ ] napi_is_exception_pending, napi_get_and_clear_last_exception
- [ ] Proper Python exception to NAPI error translation

### Priority 3 - ArrayBuffer & TypedArrays
- [ ] napi_create_arraybuffer, napi_get_arraybuffer_info
- [ ] napi_create_typedarray (full implementation)
- [ ] napi_create_buffer, napi_get_buffer_info
- [ ] Zero-copy buffer sharing with Python memoryview

### Priority 4 - References & Scopes
- [ ] napi_escape_handle, escapable handle scopes
- [ ] Proper reference counting (ref/unref)
- [ ] Weak references with invoke finalizer

### Priority 5 - Async Work
- [ ] napi_create_async_work, napi_queue_async_work
- [ ] napi_cancel_async_work
- [ ] Thread pool integration

### Priority 6 - Additional Types
- [ ] BigInt support
- [ ] Date support
- [ ] Symbol support
- [ ] napi_define_properties

### Priority 7 - Advanced
- [ ] napi_type_tag_object, napi_check_object_type_tag
- [ ] napi_add_finalizer
- [ ] External arraybuffers
