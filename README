# napi-python

Load Node-API (.node) native addons in Python.

## Goal

Run native addons built with napi-rs, node-addon-api, or raw N-API directly in Python without Node.js.

## How it works

1. A C shim library exports all NAPI symbols
2. Python implements the NAPI functions via ctypes
3. When a .node file loads, it resolves symbols from our shim
4. Native callbacks get wrapped as Python callables

## Usage

```python
from napi_python import load_addon

# Load addon
addon = load_addon("path/to/addon.node")

# Call functions
result = addon.add(1, 2)

# Use classes
counter = addon.Counter(10)
counter.increment()
print(counter.value)  # 11

# Async with asyncio
import asyncio
result = await addon.asyncAdd(1, 2)
```

## Status

Working features:
- Simple functions (numbers, strings, arrays)
- Callbacks (Python lambdas work as native callbacks)
- Classes (constructor, methods, getters/setters)
- Promises/async (returns asyncio.Future, works with await)
- Threadsafe functions (cross-thread callbacks)

## TODO

See IMPLEMENTATION_PLAN.md for full details.

### Priority 1 - Bug Fixes
- [ ] Fix string argument truncation

### Priority 2 - Error Handling
- [ ] napi_throw, napi_throw_error, napi_throw_type_error
- [ ] napi_is_exception_pending, napi_get_and_clear_last_exception
- [ ] Proper Python exception to NAPI error translation

### Priority 3 - ArrayBuffer & TypedArrays
- [ ] napi_create_arraybuffer, napi_get_arraybuffer_info
- [ ] napi_create_typedarray (full implementation)
- [ ] napi_create_buffer, napi_get_buffer_info
- [ ] Zero-copy buffer sharing with Python memoryview

### Priority 4 - References & Scopes
- [ ] napi_escape_handle, escapable handle scopes
- [ ] Proper reference counting (ref/unref)
- [ ] Weak references with invoke finalizer

### Priority 5 - Async Work
- [ ] napi_create_async_work, napi_queue_async_work
- [ ] napi_cancel_async_work
- [ ] Thread pool integration

### Priority 6 - Additional Types
- [ ] BigInt support
- [ ] Date support  
- [ ] Symbol support
- [ ] napi_define_properties

### Priority 7 - Advanced
- [ ] napi_type_tag_object, napi_check_object_type_tag
- [ ] napi_add_finalizer
- [ ] External arraybuffers
